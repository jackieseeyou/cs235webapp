{% extends 'layout.html' %}

{% block title %} Games {% endblock %}

<body>
    {% block sidebar_content %}
    <div class="search_filter_container">
        <div class="search__container">
            <input type="text" id="search-box" placeholder="Search games...">
            <div id="search-results" class="search-dropdown"></div>
        </div>

        <p><strong>Genres:</strong></p>
        <div class="genre_filter_container">
            <form>
                <ul>
                    {% for genre in genres %}
                    <li>
                        <input type="checkbox" id="{{ genre }}" name="{{ genre.genre_name }}" value="{{ genre.genre_name }}">
                        <label for="{{ genre.genre_name }}">{{ genre }}</label>
                    </li>
                    {% endfor %}
                </ul>
            </form>


        </div>
        <div class="publisher_filter_container">
            <form>
                <ul>
                    {% for publisher in publishers %}
                    <li>
                        <input type="checkbox" id="{{ publisher }}" name="{{ publisher }}" value="{{ publisher }}">
                        <label for="{{ publisher }}">{{ publisher }}</label>
                    </li>
                    {% endfor %}
                </ul>
            </form>
            
        </div>
    </div>

    <button>apply filter(s)</button>
    {% endblock %}

    {% block content %}
    <div class="games__table__container">
        <table class="games__table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Release Date</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                {% for game in games %}
                <tr>
                    <td>
                        {{ game.game_id }}
                    </td>
                    <td>
                        <div id="game-link-container">
                        <a href="{{ url_for('description_bp.description', game_id = game.game_id) }}"id="game-image"><img src="{{ game.image }}"></img> {{ game.title }}</a>
                        </div>
                    </td>
                    <td>
                        {{ game.release_date }}
                    </td>
                    <td>
                        ${{ game.price }}
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {{ pagination.links }}
</body>

<script>
    document.getElementById('search-box').addEventListener('keyup', function() {
    let query = this.value;
    let resultsContainer = document.getElementById('search-results');

    if (query.length > 2) {
        fetch(`/search/${query}`)
            .then(response => response.json())
            .then(data => {
                resultsContainer.innerHTML = '';
                if (data.length > 0) {
                    data.forEach(game => {
                        var game_id = game.game_id;
                        var url = '/browse/' + game_id;
                        resultsContainer.innerHTML += `
                            <a href=${url}><div class="search-result-item">
                                <img src="${game.image}" alt="${game.title}" width="100px">
                                ${game.title}
                            </div></a>
                        ;
                    });
                    resultsContainer.style.display = 'block';  // Show the results
                } else {
                    resultsContainer.style.display = 'none';   // Hide if no results
                }
            });
    } else {
        resultsContainer.style.display = 'none';   // Hide if input is too short
    }
});

// Optionally, close the dropdown when clicking elsewhere
document.addEventListener('click', function(event) {
    if (event.target.id !== 'search-box' && event.target.id !== 'search-results') {
        document.getElementById('search-results').style.display = 'none';
    }
});

    </script>
{% endblock %}